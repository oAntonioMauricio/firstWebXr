<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script
        src="https://raw.githack.com/aframevr/aframe/master/dist/aframe-device-orientation-controls.min.js"></script>

    <script>
        AFRAME.registerComponent('position-feedback', {
            tick: function () {
                var cameraPosition;
                if (this.el.sceneEl.is('vr-mode') || this.el.sceneEl.is('ar-mode')) {
                    cameraPosition = this.el.sceneEl.camera.el.getAttribute('position');
                } else {
                    cameraPosition = document.getElementById('mobileCamera').getAttribute('position');
                }
                var positionText = 'Position: ' + cameraPosition.x.toFixed(2) + ' ' + cameraPosition.y.toFixed(2) + ' ' + cameraPosition.z.toFixed(2);
                document.getElementById('movementFeedback').setAttribute('text', 'value', positionText);
            }
        });

        AFRAME.registerComponent('physical-movement', {
            init: function () {
                var el = this.el;
                var isMoving = false; // Flag to track movement

                // Threshold for detecting movement
                var movementThreshold = 0.1; // Adjust this value as needed

                window.addEventListener('devicemotion', function (event) {
                    var acceleration = event.accelerationIncludingGravity;

                    // Calculate the magnitude of acceleration
                    var accelerationMagnitude = Math.sqrt(
                        Math.pow(acceleration.x, 2) +
                        Math.pow(acceleration.y, 2) +
                        Math.pow(acceleration.z, 2)
                    );

                    // Check if acceleration exceeds threshold
                    if (accelerationMagnitude > movementThreshold) {
                        isMoving = true;
                    }
                });

                // Move the camera forward if moving
                el.sceneEl.addEventListener('tick', function () {
                    if (isMoving) {
                        var camera = el.sceneEl.camera.el;
                        var currentPosition = camera.getAttribute('position');

                        // Move the camera forward
                        camera.setAttribute('position', {
                            x: currentPosition.x,
                            y: currentPosition.y,
                            z: currentPosition.z - 0.05 // Adjust this value as needed
                        });
                    }
                });
            }
        });
    </script>

</head>

<body>
    <a-scene vr-mode-ui="enabled: false" cursor="rayOrigin: mouse">
        <!-- Camera with controls -->
        <a-entity id="cameraRig" position="0 1.6 0" position-feedback physical-movement>
            <!-- Desktop keyboard controls -->
            <a-camera wasd-controls look-controls></a-camera>

            <!-- Mobile device orientation controls -->
            <a-camera id="mobileCamera" device-orientation-controls movement-controls></a-camera>
        </a-entity>

        <!-- Text to indicate movement -->
        <a-entity id="movementFeedback" position="0 1.5 -2" text="value: Position: 0 1.6 0" scale="6 6 6"></a-entity>

        <!-- Your scene objects -->
        <a-box position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9"></a-box>
        <a-sphere position="0 1.25 -5" radius="1.25" color="#EF2D5E"></a-sphere>
        <a-cylinder position="1 0.75 -3" radius="0.5" height="1.5" color="#FFC65D"></a-cylinder>
        <a-plane position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane>
        <a-sky color="#ECECEC"></a-sky>
    </a-scene>
</body>

</html>